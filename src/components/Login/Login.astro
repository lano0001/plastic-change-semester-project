---
const STORAGE_KEY = "iform-totally-logged-in"; // localStorage key
const PASS = "kea"; // demo password
---

<div
  id="login-gate"
  class="fixed inset-0 z-[9999] hidden"
  data-key={STORAGE_KEY}
  data-pass={PASS}
>
  <div class="absolute inset-0 bg-black/90"></div>

  <div
    role="dialog"
    aria-modal="true"
    aria-labelledby="login-title"
    class="relative mx-auto mt-24 w-[92%] max-w-sm rounded-2xl bg-white p-6 text-slate-900 shadow-2xl"
  >
    <h1 id="login-title" class="text-center text-2xl font-bold">Login</h1>
    <p class="mt-2 text-center text-slate-600">
      Skriv adgangskode for at logge ind (kea)
    </p>

    <form id="login-form" class="mt-6 grid gap-3">
      <input
        type="password"
        name="pass"
        placeholder="Password"
        autocomplete="current-password"
        required
        class="rounded-lg border border-slate-300 px-3 py-2"
      />
      <button
        class="rounded-lg bg-blue-600 px-4 py-2 font-semibold text-white hover:bg-blue-700"
      >
        Login
      </button>
    </form>
  </div>
</div>

<script is:inline>
  (function () {
    const gate = document.getElementById("login-gate");
    const form = document.getElementById("login-form");
    if (!gate || !form) return;

    const KEY = gate.dataset.key || "iform-totally-logged-in";
    const PASS = gate.dataset.pass || "kea";

    if (!localStorage.getItem(KEY)) {
      gate.classList.remove("hidden");

      setTimeout(() => form.querySelector('input[name="pass"]')?.focus(), 0);
    }

    // Handle submit
    form.addEventListener("submit", function (e) {
      e.preventDefault();
      const input = this.querySelector('input[name="pass"]');
      if (input && input.value === PASS) {
        localStorage.setItem(KEY, "1");
        gate.remove();
      } else if (input) {
        input.setCustomValidity("Forkert kodeord");
        input.reportValidity();
        setTimeout(() => input.setCustomValidity(""), 1500);
      }
    });
  })();
</script>
